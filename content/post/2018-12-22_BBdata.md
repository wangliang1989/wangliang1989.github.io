---
title: "cdut 宽频/甚宽频数据整理"
date: 2018-12-22T16:28:00+08:00
lastmod: 2018-12-22T16:28:00+08:00
draft: false
tags: ["数据管理"]
categories: ["地震学软件"]
author: 王亮
weight: 10
contentCopyright: '<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank">CC 4.0</a>'
mathjax: true
slug: BBdata
---

经过快一个月的努力，我把我们 cdut 宽频/甚宽频台站的数据进行了整理，解决了数据截取和仪器响应两个问题。
期望在这里，通过这篇博文，把我的做法推广给组内同学。

如何截取数据才是正确的方式呢？和 IRIS 一样就是正确的。
`BREQ_FAST` 是 IRIS 的发邮件申请数据的工具。
在这里，我写的脚本就是读取 `BREQ_FAST` 文件来截取数据，使数据的截取形式和 IRIS 的 `BREQ_FAST` 数据申请的结果一致。
这样，今后无论哪种地震学方法，数据处理的脚本都可以轻易地写为既可以处理 IRIS 下载的数据，也可以处理我们自己的数据。

# 建立索引文件

我是将自己的数据放在路径 `/data` 下面。
我们宽频/甚宽频台站的数据是存放在路径 `/data/2017LiangCT_WuJ_LushanGAP` 下面的。
其他台网的数据，比如短周期数据也是放在 `/data` 下面。
要建立索引文件，可以使用脚本 `getstation.pl` 来建立索引文件，索引文件会放在 `2017LiangCT_WuJ_LushanGAP` 的上一级。
索引文件是一个普通的文本文件：`index.txt`。形式如下：

```text
BBSX /data/2017LiangCT_WuJ_LushanGAP/BBSX/2016327/2016.327.09.BBSX.00.BHE.SAC 1479806682 1479808857.99
BBSX /data/2017LiangCT_WuJ_LushanGAP/BBSX/2016327/2016.327.09.BBSX.00.BHN.SAC 1479806682 1479808857.99
```

第一列是台站名称，第二列是 SAC 文件的包含绝对路径的名称。
后面两列数字是文件第一个和最后一个数据点的时刻，即相对于计算机元年的秒数。

同时， `getstation.pl` 还会生成一个 `station_builder.txt` 文件。
这个文件是针对人的表述文件，方便人的阅读，形式如下：

```text
CD|BBSX|30.3282|103.046|CDUT|2016-11-22T09:24:42|2018-01-27T10:08:01|
CD|BCPC|30.9483|103.316|CDUT|2016-11-25T03:00:00|2018-01-28T04:00:18|
CD|BFSC|30.5991|103.187|CDUT|2016-11-27T04:51:16|2018-01-30T07:41:08|
```

这个文件的形式和 IRIS 的 station builder 生成的 TEXT 格式是一致的。
CD 为台网名。CDUT 是对台站的描述，在处理数据时其实不发生作用。

# 数据截取

这里，数据截取需要你自己准备好一个 `BREQ_FAST` 文件，这方面可以在 seisman 上找到资料。

首先把刚才的索引文件所在路径添加环境变量：

```text
# DATABASE
export DATA_BASE=/data
```

然后，使用脚本 `breq2data.pl` 即可：

```bash
perl breq2data.pl 20180123.breq
```

届时，脚本提供的数据形式就和  `BREQ_FAST` 解压 seed 文件出来的相同。

# 仪器响应

仪器响应的问题，已经整理为一个 word 文档来说明问题和 PZ 文件来去仪器响应（组内私下分享）。
使用方法（如果是用我提供的脚本截取数据，则可以正确运行，直接使用会出错）：

```bash
SAC> r *SAC
SAC> rglitches;
SAC> rmean;rtr;taper
SAC> trans from polezero subtype PZ.ALL to none freq 0.1 0.2 5 10
SAC> mul 1.0e9 # 振幅转为位移，单位转为 nm
SAC> w over
SAC> q
```

# 脚本的获取

脚本的获取请组内私下联系。
